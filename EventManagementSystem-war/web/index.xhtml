<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html">

    <body>
        <!--        <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet"/>
                <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>-->

        <ui:composition template="./layout/default2.xhtml">


            <ui:define name="top">
                Main Page
            </ui:define>

            <ui:define name="content">
                <div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="bannerImage/gallery1.png" class="d-block w-100" alt="..."/>
                        </div>
                        <div class="carousel-item">
                            <img src="bannerImage/gallery2.png" class="d-block w-100" alt="..."/>
                        </div>
                        <div class="carousel-item">
                            <img src="bannerImage/gallery3.png" class="d-block w-100" alt="..."/>
                        </div>
                    </div>
                </div>


                <div class="container">
                    <div class="row">
                        <div class="col-lg-6 mx-auto">
                            <div class="input-group">
                                <input type="text" id="searchInput" class="form-control" placeholder="Enter search query"/>
                                <span class="input-group-btn">
                                    <button class="btn btn-secondary"  onclick="search()" type="button">Go!</button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4" id="results"></div>




                &nbsp;


                &nbsp;


                <!-- Bootstrap CSS -->
                <!--<link href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet"/>-->

                <!-- Bootstrap JavaScript (Bundle with Popper) -->
                <!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>-->

                <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
                <script src="js/owl.carousel.min.js"></script>

                <script>
                                        const myCarouselElement = document.querySelector('#myCarousel')

                                        const carousel = new bootstrap.Carousel(myCarouselElement, {
                                            interval: 2000,
                                            touch: false
                                        })
                </script>

                <script>
                    window.onload = function () {
                        loadAllResults();
                    }


                    function loadAllResults() {
                        var url = './webresources/events'

                        fetch(url)
                                .then(response => response.json())
                                .then(data => {
                                    displayResults(data);
                                })
                                .catch(error => {
                                    console.error('Error fetching data:', error);
                                });
                    }

                    function displayResults(results) {
                        var resultsDiv = document.getElementById('results');
                        resultsDiv.innerHTML = ''; // Clear previous results

                        if (results.length === 0) {
                            resultsDiv.innerHTML = '<p class="text-muted">No results found.</p>';
                            return;
                        }

//                        results.forEach(result => {
//                            console.log(result.title);
//                            var name = result.title;
//                            var card = `
//                                <div class="col-md-4 mb-4">
//                                    <div class="card">
//                                        <div class="card-body">
//                                            <h5 class="card-title">Title: ${result.title}</h5>
//                                            <p class="card-text">${result.description}</p>
//                                        </div>
//                                    </div>
//                                </div>
//                            `;
//                            resultsDiv.innerHTML += card;
//                        });

                        results.forEach(result => {
                            console.log(result);
                            var card =
                                    '<div class="col-md-4 mb-4">' +
                                    '  <div class="card">' +
                                    '      <p class="card-text"> &nbsp;&nbsp;' + result.eventCategory + '</p>' +
                                    '   <img class="card-img-top" src="eventPicture/' + result.eventImage + '" alt="Card image cap"/>' +
                                    '    <div class="card-body">' +
                                    '      <h3 class="card-title">' + result.title + '</h3>' +
                                    '      <p class="card-text">' + result.description + '</p>' +
                                    '      <p class="card-text">' + result.date + '</p>' +
                                    '      <p class="card-text"> Sign Up By ' + result.deadline + '</p>' +
                                    '    </div>' +
                                    '  </div>' +
                                    '</div>';

                            resultsDiv.insertAdjacentHTML('beforeend', card);
                        });
                    }


                    function search() {
                        var query = document.getElementById('searchInput').value;
                        console.log("testing" + query);
                        var url = './webresources/events/query?searchTerm=' + encodeURIComponent(query);

                        fetch(url)
                                .then(response => response.json())
                                .then(data => {
                                    displayResults(data);
                                })
                                .catch(error => {
                                    console.error('Error fetching data:', error);
                                });
                    }


                </script>


            </ui:define>



        </ui:composition>

    </body>
</html>
