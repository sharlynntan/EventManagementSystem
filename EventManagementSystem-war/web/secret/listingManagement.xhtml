<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../layout/default2.xhtml">

            <ui:define name="content">

                <h:form id ="createEvent">
                    <!-- Change type from "submit" to "button" -->
                    &nbsp;
                    <h:commandButton value="Add Event" onclick="addEvent()" class="btn btn-primary" type="button"/>
                </h:form>

                <div class="row mt-4" id="results"></div>


                <div id="dialog" class="dialog">
                    <div class="dialog-content">
                        <span class="close" onclick="closeEvent()">&times;</span>
                        <h2>Add New Event</h2>
                        <p>This is a dialog content.</p>
                        <h:form id="editprofile">
                            <div class="center-content">
                                <p>
                                    <label for="title">Title</label>
                                    <h:inputText id="firstName" value="#{eventManagedBean.title}" styleClass="form-control" />
                                </p>

                                <p>
                                    <p>Event Date Time: <input type="text" id="datetimepicker" /></p>
                                    <h:inputHidden id="selectedDateTime" value="#{eventManagedBean.eventDate}" />

                                </p>

                                <p>
                                    <h:outputText value="Event Category" />
                                    <h:selectOneMenu value="#{eventManagedBean.eventCat}">
                                        <f:selectItem itemValue="Music" itemLabel="Music" /> 
                                        <f:selectItem itemValue="Nightlife" itemLabel="Nightlife" /> 
                                        <f:selectItem itemValue="Performing Art" itemLabel="Performing Art" /> 
                                        <f:selectItem itemValue="Holidays" itemLabel="Holidays" /> 
                                        <f:selectItem itemValue="Health" itemLabel="Health" /> 
                                        <f:selectItem itemValue="Hobbies" itemLabel="Hobbies" /> 
                                        <f:selectItem itemValue="Business" itemLabel="Business" /> 
                                        <f:selectItem itemValue="Food and Drink" itemLabel="Food and Drink" /> 
                                        <f:selectItem itemValue="Other" itemLabel="Other" /> 
                                    </h:selectOneMenu>
                                </p>

                                <p>
                                    <p>Deadline: <input type="text" id="deadlinePicker" /></p>
                                    <h:inputHidden id="selectedDeadline" value="#{eventManagedBean.deadline}" />

                                </p>

                                <p>
                                    <label for="title">Description</label>
                                    <h:inputText id="description" value="#{eventManagedBean.description}" styleClass="form-control" />
                                </p>

                                <p>
                                    <label for="maxPax">Max Pax:</label>
                                    <h:inputText id="maxPax" value="#{eventManagedBean.maxPax}" styleClass="form-control" />
                                </p>

                                <p>
                                    <label for="duration">Duration:</label>
                                    <h:inputText id="duration" value="#{eventManagedBean.estimateDurationMins}" styleClass="form-control" />
                                </p>

                                <p>
                                    <label for="street1">Street 1:</label>
                                    <h:inputText id="street1" value="#{eventManagedBean.street1}" styleClass="form-control" />
                                </p>

                                <p>
                                    <label for="street2">Street 2:</label>
                                    <h:inputText id="street2" value="#{eventManagedBean.street2}" styleClass="form-control" />
                                </p>

                                <p>
                                    <label for="city">City:</label>
                                    <h:inputText id="city" value="#{eventManagedBean.city}" styleClass="form-control" />
                                </p>

                                <p>
                                    <label for="postalCode">Postal Code:</label>
                                    <h:inputText id="postalCode" value="#{eventManagedBean.postalCode}" styleClass="form-control" />
                                </p>

                                <h:commandButton action="#{personManagedBean.addEvent}" value="Add Event" class="btn btn-primary"/>

                            </div>
                        </h:form>

                    </div>
                </div>


                <script>
                    window.onload = function () {
                        loadAllResults();
                    }

                    function addEvent() {
                        document.getElementById('dialog').style.display = 'block';
                    }

                    function closeEvent() {
                        document.getElementById('dialog').style.display = 'none';
                    }

                    $(document).ready(function () {
                        $('#datetimepicker').datetimepicker({
                            dateFormat: 'dd-mm-yyyy', // Set the date format
                            timeFormat: 'HH:mm', // Set the time format
                            onSelect: function (dateTimeText) {
                                // Update the hidden input field with the selected date time
                                document.getElementById('selectedDateTime').value = dateTimeText;
                                console.log(dateTimeText);
                            }
                        });
                    });

                    $('#deadlinePicker').datetimepicker({
                        dateFormat: 'dd-mm-yyyy', // Set the date format
                        timeFormat: 'HH:mm', // Set the time format
                        onSelect: function (dateTimeText) {
                            // Update the hidden input field with the selected date time
                            document.getElementById('selectedDeadline').value = dateTimeText;
                            console.log(dateTimeText);
                        }
                    });

                    function loadAllResults() {
                        var userId = '${authenticationManagedBean.userId}';
                        var url = '.././webresources/events/' + userId;

                        fetch(url)
                                .then(response => response.json())
                                .then(data => {
                                    displayResults(data);
                                })
                                .catch(error => {
                                    console.error('Error fetching data:', error);
                                });
                    }


                    function displayResults(results) {
                        var resultsDiv = document.getElementById('results');
                        resultsDiv.innerHTML = ''; // Clear previous results

                        if (results.length === 0) {
                            resultsDiv.innerHTML = '<p class="text-muted">No results found.</p>';
                            return;
                        }

//                        results.forEach(result => {
//                            console.log(result.title);
//                            var name = result.title;
//                            var card = `
//                                <div class="col-md-4 mb-4">
//                                    <div class="card">
//                                        <div class="card-body">
//                                            <h5 class="card-title">Title: ${result.title}</h5>
//                                            <p class="card-text">${result.description}</p>
//                                        </div>
//                                    </div>
//                                </div>
//                            `;
//                            resultsDiv.innerHTML += card;
//                        });

                        results.forEach(result => {
                            console.log(result);
                            var card =
                                    '<div class="col-md-4 mb-4">' +
                                    '  <div class="card">' +
                                    '      <p class="card-text"> &nbsp;&nbsp;' + result.eventCategory + '</p>' +
                                    '   <img class="card-img-top" src=".././eventPicture/' + result.eventImage + '" alt="Card image cap"/>' +
                                    '    <div class="card-body">' +
                                    '      <h3 class="card-title">' + result.title + '</h3>' +
                                    '      <p class="card-text">' + result.description + '</p>' +
                                    '      <p class="card-text">' + result.date + '</p>' +
                                    '      <p class="card-text"> Sign Up By ' + result.deadline + '</p>' +
                                    '    </div>' +
                                    '  </div>' +
                                    '</div>';

                            resultsDiv.insertAdjacentHTML('beforeend', card);
                        });
                    }
                </script>
            </ui:define>

        </ui:composition>

    </body>
</html>
